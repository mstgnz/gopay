openapi: 3.0.0
info:
  title: GoPay API Documentation
  version: 1.5.0
  description: |
    **GoPay** is a unified payment integration service developed in Go. It abstracts different payment providers behind a single, standardized API, allowing developers to switch payment systems seamlessly without changing their codebase.

    ## Key Features
    - üîÑ **Unified API Interface**: Standardize diverse payment gateway APIs (ƒ∞yzico, OzanPay, Stripe, etc.) into a consistent format
    - üîå **Plug-and-Play Architecture**: Easily switch between payment providers without code changes
    - üè¢ **Provider Agnostic**: Add new payment gateways without disrupting existing implementations
    - üè¢ **Multi-Tenant Support**: Multiple projects can use different provider configurations simultaneously
    - üîê **3D Secure Support**: Complete 3D Secure payment flow with callback handling
    - üí∞ **Full Payment Lifecycle**: Process, track, cancel, and refund payments
    - üéØ **Webhook Integration**: Receive real-time payment notifications
    - üõ°Ô∏è **Secure by Design**: Built-in authentication and security features
    - üîê **JWT Authentication**: Secure user authentication with token-based access
    - üíæ **PostgreSQL Database**: Persistent configuration and comprehensive payment logging
    - üìä **Advanced Logging**: Complete request/response logging with PostgreSQL storage

    ## Supported Payment Providers
    - ‚úÖ **ƒ∞yzico** (Turkey) - Full integration with 3D Secure support
    - ‚úÖ **OzanPay** (Turkey) - Production ready
    - ‚úÖ **Stripe** (Global) - Production ready
    - ‚úÖ **Paycell** (Turkey) - Production ready
    - ‚úÖ **Papara** (Turkey) - Production ready
    - ‚úÖ **Nkolay** (Turkey) - Production ready
    - ‚úÖ **PayTR** (Turkey) - Production ready
    - ‚úÖ **PayU** (Global) - Production ready

    ## Authentication System
    GoPay uses JWT (JSON Web Token) based authentication with auto-rotating secret keys for maximum security.

    ### Getting Started
    1. **First Setup**: Register first admin user with `POST /v1/auth/register`
    2. **Subsequent Users**: Use `POST /v1/auth/create-tenant` (admin only)
    3. **Login**: Get JWT token with `POST /v1/auth/login`
    4. **API Access**: Include token in Authorization header: `Bearer <token>`

    ### Registration Rules
    - ‚úÖ **First User**: Automatic admin privileges, no restrictions
    - ‚ùå **Additional Users**: Only admin can create via create-tenant endpoint

    ### üîê Enhanced Security Model
    **Auto-Rotating JWT Secret Keys:**
    - JWT secret key regenerates on every service restart
    - All existing tokens become invalid after restart
    - Users must re-authenticate after service restart
    - No persistent secret storage (UUID-generated keys)
    
    **Token Management:**
    - **Expiry**: 24 hours default
    - **Refresh**: Use `/v1/auth/refresh` to extend validity
    - **Validation**: Use `/v1/auth/validate` to check token status
    - **Security**: Each API request validates token against current secret
    
    **Benefits:**
    - ‚úÖ Maximum security through key rotation
    - ‚úÖ No risk of leaked persistent secrets
    - ‚úÖ Automatic token invalidation on restart
    - ‚úÖ Forces regular re-authentication

    ## Database & Logging
    GoPay uses **PostgreSQL 17.5** for:
    - **User Management**: Secure tenant authentication
    - **Payment Logging**: Complete request/response tracking
    - **Configuration Storage**: Tenant-specific provider settings
    - **Analytics**: Real-time payment statistics

    ### Payment Logging Features
    - üìù **Request/Response Logging**: All payment requests logged to provider-specific tables
    - ‚è±Ô∏è **Performance Tracking**: Processing time measurement
    - üîç **Error Analysis**: Detailed error logging and categorization
    - üìä **Multi-tenant Isolation**: Secure data separation

    ## Multi-Tenant Configuration
    GoPay supports multi-tenant architecture where different projects can use different payment provider configurations.

    ### Setup Flow
    1. **Authenticate**: Get JWT token via login
    2. **Configure**: `POST /v1/config/tenant` - Configure payment provider (tenant automatically detected from JWT token)
    3. **Process**: Use payment endpoints with JWT token - Automatically uses tenant-specific configuration

    ### JWT Token Authentication
    The system automatically extracts tenant information from JWT tokens:
    ```
    Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    ```

    ## Payment Flow
    ### Regular Payment
    1. `POST /v1/payments/{provider}` - Process payment
    2. `GET /v1/payments/{provider}/{paymentID}` - Check status
    3. `POST /v1/payments/{provider}/refund` - Refund if needed

    ### 3D Secure Payment
    1. `POST /v1/payments/{provider}` with `use3D: true` - Initialize 3D payment
    2. User completes 3D authentication on bank page
    3. `GET|POST /v1/callback/{provider}` - Handle callback
    4. `GET /v1/payments/{provider}/{paymentID}` - Verify final status

    ## Contact
    - **Developer**: Mesut GENEZ
    - **GitHub**: [https://github.com/mstgnz/gopay](https://github.com/mstgnz/gopay)
    - **License**: Boost Software License 1.0

servers:
  - url: http://localhost:9999
    description: Local development server
  - url: https://gopay.yourcompany.com
    description: Production server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token required for authentication
  
  schemas:
    # Authentication Schemas
    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
          example: "admin"
          description: User username
        password:
          type: string
          minLength: 6
          example: "password123"
          description: User password

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
          description: JWT authentication token
        expires_at:
          type: string
          format: date-time
          example: "2024-01-16T10:30:00Z"
          description: Token expiration time
        username:
          type: string
          example: "admin"
          description: Username
        tenant_id:
          type: string
          example: "1"
          description: Tenant ID

    RegisterRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
          example: "admin"
          description: Desired username
        password:
          type: string
          minLength: 6
          example: "password123"
          description: Password for the account

    ChangePasswordRequest:
      type: object
      required: [new_password]
      properties:
        current_password:
          type: string
          minLength: 6
          example: "oldpassword123"
          description: Current password (required when changing own password)
        new_password:
          type: string
          minLength: 6
          example: "newpassword123"
          description: New password
        target_tenant_id:
          type: integer
          example: 2
          description: Target tenant ID (admin only - for changing other users' passwords)

    CreateTenantRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 50
          example: "newuser"
          description: Username for new tenant
        password:
          type: string
          minLength: 6
          example: "password123"
          description: Password for new tenant

    UserProfile:
      type: object
      properties:
        id:
          type: integer
          example: 1
          description: Tenant ID
        username:
          type: string
          example: "admin"
          description: Username
        last_login:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: Last login time
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
          description: Account creation time

    # Common Response Schemas
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Operation success status
          example: true
        message:
          type: string
          description: Operation result message
          example: "Payment processed successfully"
        data:
          type: object
          description: Response data
          
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Always false for errors
          example: false
        message:
          type: string
          description: Error message
          example: "Payment failed"
        error:
          type: string
          description: Detailed error information
          example: "Invalid card number"

    # Payment Related Schemas
    PaymentStatus:
      type: string
      enum: [pending, processing, successful, failed, cancelled, refunded]
      description: Current payment status

    Address:
      type: object
      properties:
        city:
          type: string
          example: "Istanbul"
        country:
          type: string
          example: "Turkey"
        address:
          type: string
          example: "Atat√ºrk Mahallesi 123 Sokak No:45"
        zipCode:
          type: string
          example: "34000"
        description:
          type: string
          example: "Home address"

    Customer:
      type: object
      required: [name, surname, email]
      properties:
        id:
          type: string
          example: "customer123"
          description: Unique customer identifier
        name:
          type: string
          example: "John"
          description: Customer first name
        surname:
          type: string
          example: "Doe"
          description: Customer last name
        email:
          type: string
          format: email
          example: "john.doe@example.com"
          description: Customer email address
        phoneNumber:
          type: string
          example: "+905551234567"
          description: Customer phone number
        ipAddress:
          type: string
          format: ipv4
          example: "192.168.1.1"
          description: Customer IP address
        address:
          $ref: '#/components/schemas/Address'

    CardInfo:
      type: object
      required: [cardHolderName, cardNumber, expireMonth, expireYear, cvv]
      properties:
        cardHolderName:
          type: string
          example: "John Doe"
          description: Name on the card
        cardNumber:
          type: string
          example: "5528790000000008"
          description: Card number (for ƒ∞yzico test use 5528790000000008)
        expireMonth:
          type: string
          pattern: '^(0[1-9]|1[0-2])$'
          example: "12"
          description: Card expiration month (MM)
        expireYear:
          type: string
          pattern: '^20[2-9][0-9]$'
          example: "2030"
          description: Card expiration year (YYYY)
        cvv:
          type: string
          pattern: '^[0-9]{3,4}$'
          example: "123"
          description: Card verification value

    Item:
      type: object
      properties:
        id:
          type: string
          example: "item1"
          description: Item identifier
        name:
          type: string
          example: "Premium Product"
          description: Item name
        description:
          type: string
          example: "High quality product"
          description: Item description
        category:
          type: string
          example: "Electronics"
          description: Item category
        price:
          type: number
          format: float
          example: 100.50
          description: Item price
        quantity:
          type: integer
          minimum: 1
          example: 1
          description: Item quantity

    PaymentRequest:
      type: object
      required: [amount, currency, customer, cardInfo]
      properties:
        id:
          type: string
          example: "payment123"
          description: Payment identifier
        referenceId:
          type: string
          example: "order456"
          description: External reference ID
        currency:
          type: string
          enum: [TRY, USD, EUR]
          example: "TRY"
          description: Payment currency
        amount:
          type: number
          format: float
          minimum: 0.01
          example: 100.50
          description: Payment amount
        customer:
          $ref: '#/components/schemas/Customer'
        cardInfo:
          $ref: '#/components/schemas/CardInfo'
        items:
          type: array
          items:
            $ref: '#/components/schemas/Item'
          description: Payment items
        description:
          type: string
          example: "Order payment"
          description: Payment description
        callbackUrl:
          type: string
          format: uri
          example: "https://yoursite.com/payment-callback"
          description: 3D Secure callback URL (required for 3D payments)
        use3D:
          type: boolean
          default: false
          example: true
          description: Enable 3D Secure authentication
        installmentCount:
          type: integer
          minimum: 1
          maximum: 12
          default: 1
          example: 1
          description: Number of installments
        paymentChannel:
          type: string
          example: "WEB"
          description: Payment channel
        paymentGroup:
          type: string
          example: "PRODUCT"
          description: Payment group
        conversationId:
          type: string
          example: "conv123"
          description: Conversation ID for tracking
        locale:
          type: string
          enum: [tr, en]
          default: "tr"
          example: "tr"
          description: Payment language
        clientIp:
          type: string
          format: ipv4
          example: "192.168.1.1"
          description: Client IP address
        clientUserAgent:
          type: string
          example: "Mozilla/5.0..."
          description: Client user agent
        metaData:
          type: string
          example: "{\"userId\":123}"
          description: Additional metadata
        redirectUrl:
          type: string
          format: uri
          example: "https://yoursite.com/payment-result"
          description: Redirect URL after payment

    PaymentResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
          description: Payment operation success
        status:
          $ref: '#/components/schemas/PaymentStatus'
        message:
          type: string
          example: "Payment successful"
          description: Operation message
        errorCode:
          type: string
          example: "5007"
          description: Provider specific error code
        transactionId:
          type: string
          example: "txn123"
          description: Transaction identifier
        paymentId:
          type: string
          example: "payment123"
          description: Payment identifier
        amount:
          type: number
          format: float
          example: 100.50
          description: Payment amount
        currency:
          type: string
          example: "TRY"
          description: Payment currency
        redirectUrl:
          type: string
          format: uri
          example: "https://3dsecure.bank.com/auth"
          description: 3D Secure redirect URL
        html:
          type: string
          example: "<form>3D Secure form</form>"
          description: 3D Secure HTML form
        systemTime:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: System timestamp
        fraudStatus:
          type: integer
          example: 1
          description: Fraud check status
        providerResponse:
          type: object
          description: Raw provider response

    RefundRequest:
      type: object
      required: [paymentId]
      properties:
        paymentId:
          type: string
          example: "payment123"
          description: Payment ID to refund
        refundAmount:
          type: number
          format: float
          example: 50.00
          description: Refund amount (leave empty for full refund)
        reason:
          type: string
          example: "Customer request"
          description: Refund reason
        description:
          type: string
          example: "Customer requested partial refund"
          description: Detailed refund description
        currency:
          type: string
          example: "TRY"
          description: Refund currency
        conversationId:
          type: string
          example: "conv123"
          description: Conversation ID

    RefundResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
          description: Refund operation success
        refundId:
          type: string
          example: "refund123"
          description: Refund identifier
        paymentId:
          type: string
          example: "payment123"
          description: Original payment ID
        status:
          type: string
          example: "success"
          description: Refund status
        refundAmount:
          type: number
          format: float
          example: 50.00
          description: Refunded amount
        message:
          type: string
          example: "Refund successful"
          description: Operation message
        errorCode:
          type: string
          example: ""
          description: Error code if failed
        systemTime:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: System timestamp
        rawResponse:
          type: object
          description: Raw provider response

    CancelRequest:
      type: object
      properties:
        reason:
          type: string
          example: "Customer request"
          description: Cancellation reason

    # Configuration Schemas
    SetEnvResponse:
      type: object
      properties:
        tenantId:
          type: integer
          example: 1
          description: Tenant identifier
        configuredProviders:
          type: array
          items:
            type: string
          example: ["iyzico", "ozanpay"]
          description: List of successfully configured providers
        message:
          type: string
          example: "Provider configurations set successfully"
          description: Success message

    TenantConfigResponse:
      type: object
      properties:
        tenantId:
          type: integer
          example: 1
          description: Tenant identifier
        provider:
          type: string
          example: "iyzico"
          description: Provider name
        config:
          type: object
          additionalProperties:
            type: string
          example:
            apiKey: "sand****key"
            secretKey: "sand****ret"
            environment: "sandbox"
          description: Masked configuration values

    StatsResponse:
      type: object
      properties:
        memory_configs:
          type: integer
          example: 15
          description: Number of configurations in memory
        base_url:
          type: string
          example: "http://localhost:9999"
          description: Base URL for callbacks
        postgresql:
          type: object
          properties:
            total_configs:
              type: integer
              example: 15
              description: Total configurations in database
            unique_tenants:
              type: integer
              example: 5
              description: Number of unique tenants
            unique_providers:
              type: integer
              example: 3
              description: Number of unique providers
            total_payments:
              type: integer
              example: 1250
              description: Total payments logged
            database_size_mb:
              type: number
              format: float
              example: 45.2
              description: Database size in megabytes
            connection_status:
              type: string
              example: "connected"
              description: Database connection status
          description: PostgreSQL database statistics

    # Logging Schemas
    PaymentLog:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: Log timestamp
        tenant_id:
          type: string
          example: "tenant123"
          description: Tenant identifier
        provider:
          type: string
          example: "iyzico"
          description: Payment provider
        method:
          type: string
          example: "POST"
          description: HTTP method
        endpoint:
          type: string
          example: "/v1/payments/iyzico"
          description: API endpoint
        request_id:
          type: string
          example: "req-123"
          description: Request identifier
        user_agent:
          type: string
          example: "GoPay-Client/1.0"
          description: User agent
        client_ip:
          type: string
          format: ipv4
          example: "192.168.1.1"
          description: Client IP address
        request:
          type: object
          properties:
            headers:
              type: object
              additionalProperties:
                type: string
              example:
                Content-Type: "application/json"
                Authorization: "***REDACTED***"
              description: Request headers (sensitive data redacted)
            body:
              type: string
              example: '{"amount":100.50,"currency":"TRY","cardNumber":"***REDACTED***"}'
              description: Request body (sensitive data redacted)
            params:
              type: object
              additionalProperties:
                type: string
              description: URL parameters
        response:
          type: object
          properties:
            status_code:
              type: integer
              example: 200
              description: HTTP status code
            headers:
              type: object
              additionalProperties:
                type: string
              description: Response headers
            body:
              type: string
              example: '{"success":true,"paymentId":"pay123"}'
              description: Response body
            processing_time_ms:
              type: integer
              example: 1250
              description: Processing time in milliseconds
        payment_info:
          type: object
          properties:
            payment_id:
              type: string
              example: "payment123"
              description: Payment identifier
            amount:
              type: number
              format: float
              example: 100.50
              description: Payment amount
            currency:
              type: string
              example: "TRY"
              description: Payment currency
            customer_email:
              type: string
              format: email
              example: "john@example.com"
              description: Customer email
            status:
              type: string
              example: "successful"
              description: Payment status
            use_3d:
              type: boolean
              example: true
              description: 3D Secure used
        error:
          type: object
          properties:
            code:
              type: string
              example: "5007"
              description: Error code
            message:
              type: string
              example: "Payment failed"
              description: Error message

    LoggingStats:
      type: object
      properties:
        aggregations:
          type: object
          properties:
            total_requests:
              type: object
              properties:
                value:
                  type: integer
                  example: 150
                  description: Total number of requests
            success_count:
              type: object
              properties:
                doc_count:
                  type: integer
                  example: 142
                  description: Number of successful requests
            error_count:
              type: object
              properties:
                doc_count:
                  type: integer
                  example: 8
                  description: Number of failed requests
            avg_processing_time:
              type: object
              properties:
                value:
                  type: number
                  format: float
                  example: 245.5
                  description: Average processing time in milliseconds
            status_codes:
              type: object
              properties:
                buckets:
                  type: array
                  items:
                    type: object
                    properties:
                      key:
                        type: integer
                        example: 200
                        description: HTTP status code
                      doc_count:
                        type: integer
                        example: 142
                        description: Number of requests with this status
                  example:
                    - key: 200
                      doc_count: 142
                    - key: 400
                      doc_count: 5
                    - key: 500
                      doc_count: 3
                  description: Distribution of HTTP status codes

security:
  - BearerAuth: []

paths:
  # Configuration Operations
  /v1/config/tenant:
    post:
      summary: Configure payment provider for authenticated tenant
      description: |
        Sets up payment provider configurations for the authenticated tenant.
        Tenant information is automatically extracted from the JWT token.
        
        **JWT Token Flow:**
        1. Authenticate and get JWT token via `/v1/auth/login`
        2. Call this endpoint with Bearer token and provider credentials
        3. Use payment endpoints with the same Bearer token
        4. GoPay automatically uses tenant-specific configuration from JWT context
        
        **Supported Providers:**
        - iyzico
        - ozanpay
        - stripe
        - paycell
        - papara
        - nkolay
        - paytr
        - payu
      tags: [Configuration]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [provider, environment, configs]
              properties:
                provider:
                  type: string
                  enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
                  description: Payment provider name (select from list)
                  example: paycell
                environment:
                  type: string
                  enum: [test, prod]
                  description: Environment (test or prod)
                  example: test
                configs:
                  type: array
                  description: Provider configuration key/value pairs
                  items:
                    type: object
                    required: [key, value]
                    properties:
                      key:
                        type: string
                        description: Configuration key
                        example: username
                      value:
                        type: string
                        description: Configuration value
                        example: "paycell-user"
            examples:
              paycell_config:
                summary: Paycell Configuration
                value:
                  provider: paycell
                  environment: test
                  configs:
                    - key: username
                      value: "paycell-user"
                    - key: password
                      value: "paycell-pass"
                    - key: merchantId
                      value: "merchant456"
                    - key: terminalId
                      value: "terminal789"
      responses:
        '200':
          description: Configuration saved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/SetEnvResponse'
        '400':
          description: Invalid configuration data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
    get:
      summary: Get tenant configuration for provider
      description: |
        Retrieves the configuration for the authenticated tenant and specified provider.
        Tenant information is automatically extracted from the JWT token.
        Sensitive information (API keys, passwords) are masked in the response.
      tags: [Configuration]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: query
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
      responses:
        '200':
          description: Configuration retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TenantConfigResponse'
        '400':
          description: Missing required parameters
        '404':
          description: Configuration not found
        '500':
          description: Internal server error
    
    delete:
      summary: Delete tenant configuration for provider
      description: |
        Deletes the configuration for the authenticated tenant and specified provider.
        Tenant information is automatically extracted from the JWT token.
        This removes both the in-memory and persistent storage configuration.
      tags: [Configuration]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: query
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
      responses:
        '200':
          description: Configuration deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tenantId:
                            type: integer
                            example: 1
                          provider:
                            type: string
                            example: "iyzico"
                          message:
                            type: string
                            example: "Configuration deleted successfully"
        '400':
          description: Missing required parameters
        '404':
          description: Configuration not found
        '500':
          description: Internal server error

  /v1/stats:
    get:
      summary: Get system statistics
      description: |
        Returns system statistics including:
        - Number of configurations in memory
        - PostgreSQL database statistics
        - Payment logging metrics
        - Storage information
      tags: [Configuration]
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/StatsResponse'
        '500':
          description: Internal server error

  # Payment Operations
  /v1/payments/{provider}:
    post:
      summary: Process payment with specific provider
      description: |
        Processes a payment using a specific payment provider.
        Tenant-specific provider configuration is automatically loaded from JWT token context.
        
        **Available Providers:**
        - `iyzico` - ƒ∞yzico (Turkey)
        - `ozanpay` - OzanPay (Turkey) 
        - `stripe` - Stripe (Global)
        
        **JWT Token Authentication:**
        - Bearer token automatically provides tenant context
        - Tenant-specific provider configuration is used automatically
      tags: [Payments]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: environment
          in: query
          required: false
          schema:
            type: string
            enum: [sandbox, production]
          description: Payment environment default is sandbox
          example: sandbox
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentRequest'
      responses:
        '200':
          description: Payment processed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentResponse'
        '400':
          description: Invalid request or provider not supported
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error

  /v1/payments/{provider}/{paymentID}:
    get:
      summary: Get payment status with specific provider
      description: |
        Retrieves the current status of a payment using a specific provider.
        Tenant-specific provider configuration is automatically loaded from JWT token context.
      tags: [Payments]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: paymentID
          in: path
          required: true
          schema:
            type: string
          description: Payment ID to check
          example: payment123
      responses:
        '200':
          description: Payment status retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentResponse'
        '400':
          description: Invalid parameters
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error
    
    delete:
      summary: Cancel payment with specific provider
      description: |
        Cancels a payment using a specific provider.
        Tenant-specific provider configuration is automatically loaded from JWT token context.
      tags: [Payments]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: paymentID
          in: path
          required: true
          schema:
            type: string
          description: Payment ID to cancel
          example: payment123
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelRequest'
      responses:
        '200':
          description: Payment cancelled successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentResponse'
        '400':
          description: Invalid parameters or payment cannot be cancelled
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error

  # Refund Operations
  /v1/payments/{provider}/refund:
    post:
      summary: Refund payment with specific provider
      description: |
        Processes a refund using a specific provider.
        Tenant-specific provider configuration is automatically loaded from JWT token context.
      tags: [Refunds]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefundRequest'
      responses:
        '200':
          description: Refund processed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/RefundResponse'
        '400':
          description: Invalid refund request
        '401':
          description: Unauthorized - Invalid JWT token
        '404':
          description: Payment not found
        '500':
          description: Internal server error

  # 3D Secure Callbacks
  /v1/callback/{provider}:
    get:
      summary: Handle 3D Secure callback (GET) with specific provider
      description: |
        Handles 3D Secure authentication callback from the bank using GET method with specific provider.
        This endpoint is called by the bank after user completes 3D authentication.
        
        **Provider Resolution:**
        - Provider name is resolved from providers table in database
        - No tenant prefix needed, provider name is validated against active providers
        
        **Multi-Tenant Routing:**
        - Include `tenantId` query parameter for proper tenant routing (provided by bank callback)
        - No authentication required as this is called directly by payment providers
      tags: [3D Secure]
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name (must exist in providers table)
          example: iyzico
        - name: tenantId
          in: query
          required: true
          schema:
            type: string
          description: Tenant identifier for multi-tenant callback routing (optional)
          example: abc_project
        - name: paymentId
          in: query
          required: true
          schema:
            type: string
          description: Payment ID from initial 3D request
        - name: conversationId
          in: query
          schema:
            type: string
          description: Conversation ID for tracking
        - name: successUrl
          in: query
          schema:
            type: string
            format: uri
          description: URL to redirect on success
        - name: errorUrl
          in: query
          schema:
            type: string
            format: uri
          description: URL to redirect on error
      responses:
        '200':
          description: 3D Secure authentication completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentResponse'
        '302':
          description: Redirect to success/error URL
        '400':
          description: Invalid callback data
        '500':
          description: Internal server error
    
    post:
      summary: Handle 3D Secure callback (POST) with specific provider
      description: |
        Handles 3D Secure authentication callback from the bank using POST method with specific provider.
        This endpoint is called by the bank after user completes 3D authentication.
        
        **Provider Resolution:**
        - Provider name is resolved from providers table in database
        - No tenant prefix needed, provider name is validated against active providers
        
        **Multi-Tenant Routing:**
        - Include `tenantId` query parameter for proper tenant routing (provided by bank callback)
        - No authentication required as this is called directly by payment providers
      tags: [3D Secure]
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name (must exist in providers table)
          example: iyzico
        - name: tenantId
          in: query
          required: true
          schema:
            type: integer
          description: Tenant identifier for multi-tenant callback routing (optional)
          example: 1
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                paymentId:
                  type: string
                  description: Payment ID
                conversationId:
                  type: string
                  description: Conversation ID
                status:
                  type: string
                  description: 3D authentication status
                mdStatus:
                  type: string
                  description: 3D authentication result
      responses:
        '200':
          description: 3D Secure authentication completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaymentResponse'
        '302':
          description: Redirect to success/error URL
        '400':
          description: Invalid callback data
        '500':
          description: Internal server error

 # Webhook Operations (No Authentication Required)
  /v1/webhooks/{provider}:
    post:
      summary: Handle webhook notifications
      description: |
        Receives webhook notifications from payment providers for:
        - Payment status updates (success, failure)
        - Refund notifications
        - Fraud alerts
        - Chargeback notifications
        
        **Multi-Tenant Support:**
        - Include `tenantId` query parameter for tenant-specific routing
        - GoPay automatically validates signatures and processes notifications
        
        **Provider-Specific Examples:**
        
        **ƒ∞yzico Webhooks:**
        - Payment completion/failure
        - Refund confirmations
        - Fraud check results
        
        **Stripe Webhooks:**
        - Payment intent updates
        - Subscription events
        - Invoice payments
        
        **No Authentication Required** - Webhooks use cryptographic signatures for security.
      tags: [Webhooks]
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: tenantId
          in: query
          required: true
          schema:
            type: integer
          description: Tenant identifier for multi-tenant webhook routing (optional)
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
              description: Provider-specific webhook payload
            examples:
              iyzico_success:
                summary: ƒ∞yzico Payment Success
                value:
                  paymentId: "payment_123"
                  status: "success"
                  transactionId: "txn_456"
                  amount: "100.50"
                  currency: "TRY"
                  paymentTransactionId: "pt_789"
                  conversationId: "conv_abc"
              stripe_payment_intent:
                summary: Stripe Payment Intent
                value:
                  id: "evt_1234567890"
                  type: "payment_intent.succeeded"
                  data:
                    object:
                      id: "pi_1234567890"
                      amount: 10050
                      currency: "usd"
                      status: "succeeded"
              paycell_notification:
                summary: Paycell Payment Notification
                value:
                  transactionId: "123456789"
                  referenceNumber: "ref_123"
                  amount: "100.50"
                  currency: "TRY"
                  status: "SUCCESS"
                  timestamp: "2024-01-15T10:30:00Z"
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          status:
                            type: string
                            example: "accepted"
                          paymentId:
                            type: string
                            example: "payment_123"
                          processed:
                            type: boolean
                            example: true
                          timestamp:
                            type: string
                            format: date-time
                            example: "2024-01-15T10:30:00Z"
        '400':
          description: Invalid webhook data or signature
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_signature:
                  summary: Invalid Signature
                  value:
                    success: false
                    message: "Webhook signature validation failed"
                    error: "Invalid or missing signature header"
                invalid_payload:
                  summary: Invalid Payload
                  value:
                    success: false
                    message: "Invalid webhook payload"
                    error: "Required fields missing or malformed data"
        '401':
          description: Webhook authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Analytics Operations (No Authentication Required)
  /v1/analytics/dashboard:
    get:
      summary: Get dashboard statistics
      description: |
        Retrieves comprehensive dashboard statistics including:
        - Payment volume and success rates
        - Provider performance metrics
        - Recent transaction trends
        - Error rates and common issues
        
        **No Authentication Required** - This endpoint is public for dashboard display.
      tags: [Analytics]
      parameters:
        - name: provider
          in: query
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
      responses:
        '200':
          description: Dashboard statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Dashboard statistics retrieved"
                  data:
                    type: object
                    properties:
                      totalPayments:
                        type: integer
                        example: 1250
                      successfulPayments:
                        type: integer
                        example: 1187
                      failedPayments:
                        type: integer
                        example: 63
                      successRate:
                        type: number
                        format: float
                        example: 94.96
                      totalVolume:
                        type: number
                        format: float
                        example: 125430.50
                      averageAmount:
                        type: number
                        format: float
                        example: 100.34
                      topProviders:
                        type: array
                        items:
                          type: object
                          properties:
                            provider:
                              type: string
                              example: "iyzico"
                            count:
                              type: integer
                              example: 450
                            volume:
                              type: number
                              format: float
                              example: 45230.75
                      recentTrends:
                        type: array
                        items:
                          type: object
                          properties:
                            hour:
                              type: string
                              format: date-time
                              example: "2024-01-15T10:00:00Z"
                            payments:
                              type: integer
                              example: 52
                            volume:
                              type: number
                              format: float
                              example: 5234.20
        '500':
          description: Internal server error

  /v1/analytics/providers:
    get:
      summary: Get provider statistics
      description: |
        Retrieves performance statistics for all payment providers including:
        - Success rates by provider
        - Average processing times
        - Error rates and common failures
        - Volume distribution
      tags: [Analytics]
      parameters:
        - name: provider
          in: query
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
      responses:
        '200':
          description: Provider statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        provider:
                          type: string
                          example: "iyzico"
                        totalPayments:
                          type: integer
                          example: 450
                        successfulPayments:
                          type: integer
                          example: 428
                        successRate:
                          type: number
                          format: float
                          example: 95.11
                        totalVolume:
                          type: number
                          format: float
                          example: 45230.75
                        averageProcessingTime:
                          type: number
                          format: float
                          example: 1250.5
                        commonErrors:
                          type: array
                          items:
                            type: object
                            properties:
                              errorCode:
                                type: string
                                example: "INSUFFICIENT_FUNDS"
                              count:
                                type: integer
                                example: 15
        '500':
          description: Internal server error

  /v1/analytics/activity:
    get:
      summary: Get recent payment activity
      description: |
        Retrieves recent payment activity for real-time monitoring:
        - Latest transactions
        - Status changes
        - Failed payments
        - Refunds and cancellations
      tags: [Analytics]
      parameters:
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Maximum number of activities to return
          example: 20
        - name: provider
          in: query
          required: false
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Filter by specific provider
          example: iyzico
      responses:
        '200':
          description: Recent activity retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        timestamp:
                          type: string
                          format: date-time
                          example: "2024-01-15T10:30:00Z"
                        provider:
                          type: string
                          example: "iyzico"
                        paymentId:
                          type: string
                          example: "payment_123"
                        amount:
                          type: number
                          format: float
                          example: 100.50
                        currency:
                          type: string
                          example: "TRY"
                        status:
                          type: string
                          example: "successful"
                        customerEmail:
                          type: string
                          example: "user@example.com"
                        activityType:
                          type: string
                          enum: [payment, refund, cancellation, status_change]
                          example: "payment"
        '500':
          description: Internal server error

  /v1/analytics/trends:
    get:
      summary: Get payment trends
      description: |
        Retrieves payment trends over time for analytics:
        - Hourly payment volumes
        - Success rate trends
        - Provider performance over time
        - Seasonal patterns
      tags: [Analytics]
      parameters:
        - name: provider
          in: query
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
        - name: granularity
          in: query
          required: false
          schema:
            type: string
            enum: [hour, day]
            default: hour
          description: Data granularity
          example: hour
      responses:
        '200':
          description: Payment trends retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      period:
                        type: string
                        example: "24h"
                      granularity:
                        type: string
                        example: "hour"
                      trends:
                        type: array
                        items:
                          type: object
                          properties:
                            timestamp:
                              type: string
                              format: date-time
                              example: "2024-01-15T10:00:00Z"
                            totalPayments:
                              type: integer
                              example: 52
                            successfulPayments:
                              type: integer
                              example: 49
                            failedPayments:
                              type: integer
                              example: 3
                            totalVolume:
                              type: number
                              format: float
                              example: 5234.20
                            averageAmount:
                              type: number
                              format: float
                              example: 100.66
        '500':
          description: Internal server error

  # Health Check (No Authentication Required)
  /health:
    get:
      summary: Service health check
      description: |
        Returns the health status of the GoPay service including:
        - Service availability
        - PostgreSQL database connectivity
        - Payment provider connectivity
        - System version
        
        **No Authentication Required** - This is a public health check endpoint.
      tags: [System]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Service is healthy"
                  data:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "ok"
                      timestamp:
                        type: string
                        format: date-time
                        example: "2024-01-15T10:30:00Z"
                      version:
                        type: string
                        example: "1.0.0"
                      postgres_enabled:
                        type: boolean
                        example: true
                        description: PostgreSQL database status
        '503':
          description: Service unavailable

  # Logging Operations
  /v1/logs/{provider}:
    get:
      summary: List payment logs with filtering
      description: |
        Retrieves payment logs for the authenticated tenant and specified provider with various filtering options.
        
        **Tenant Isolation:**
        - Each tenant can only access their own logs
        - Tenant information is automatically extracted from JWT token
        
        **Available Filters:**
        - Payment ID
        - Payment status
        - Errors only
        - Time range (hours)
        
        **Security:**
        - Sensitive data is automatically redacted in logs
        - JWT token authentication required
      tags: [Logs]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: paymentId
          in: query
          required: false
          schema:
            type: string
          description: Filter by specific payment ID
          example: payment123
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [pending, processing, successful, failed, cancelled, refunded]
          description: Filter by payment status
          example: successful
        - name: errorsOnly
          in: query
          required: false
          schema:
            type: boolean
          description: Show only error logs
          example: true
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
      responses:
        '200':
          description: Logs retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tenantId:
                            type: integer
                            example: 1
                          provider:
                            type: string
                            example: "iyzico"
                          filters:
                            type: object
                            properties:
                              hours:
                                type: integer
                                example: 24
                              paymentId:
                                type: string
                                example: "payment123"
                              status:
                                type: string
                                example: "successful"
                              errorsOnly:
                                type: boolean
                                example: false
                          count:
                            type: integer
                            example: 15
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/PaymentLog'
        '400':
          description: Invalid parameters
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error

  /v1/logs/{provider}/payment/{paymentID}:
    get:
      summary: Get logs for specific payment
      description: |
        Retrieves all logs related to a specific payment ID for the authenticated tenant.
        Tenant information is automatically extracted from JWT token.
        
        **Use Cases:**
        - Debug payment issues
        - Track payment flow
        - Audit payment requests/responses
      tags: [Logs]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: paymentID
          in: path
          required: true
          schema:
            type: string
          description: Payment ID to get logs for
          example: payment123
        - name: X-Tenant-ID
          in: header
          required: true
          schema:
            type: string
          description: Tenant identifier (required)
          example: tenant123
      responses:
        '200':
          description: Payment logs retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tenantId:
                            type: integer
                            example: 1
                          provider:
                            type: string
                            example: "iyzico"
                          paymentId:
                            type: string
                            example: "payment123"
                          count:
                            type: integer
                            example: 3
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/PaymentLog'
        '400':
          description: Invalid parameters or missing X-Tenant-ID header
        '401':
          description: Unauthorized - Invalid JWT token
        '404':
          description: Payment logs not found
        '500':
          description: Internal server error

  /v1/logs/{provider}/errors:
    get:
      summary: Get recent error logs
      description: |
        Retrieves recent error logs for the authenticated tenant and specified provider.
        Tenant information is automatically extracted from JWT token.
        
        **Error Types:**
        - Payment failures
        - API errors
        - Validation errors
        - Provider-specific errors
      tags: [Logs]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: X-Tenant-ID
          in: header
          required: true
          schema:
            type: string
          description: Tenant identifier (required)
          example: tenant123
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
      responses:
        '200':
          description: Error logs retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tenantId:
                            type: integer
                            example: 1
                          provider:
                            type: string
                            example: "iyzico"
                          hours:
                            type: integer
                            example: 24
                          count:
                            type: integer
                            example: 5
                          logs:
                            type: array
                            items:
                              $ref: '#/components/schemas/PaymentLog'
        '400':
          description: Invalid parameters or missing X-Tenant-ID header
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error

  /v1/logs/{provider}/stats:
    get:
      summary: Get logging statistics
      description: |
        Retrieves comprehensive logging statistics for the authenticated tenant and specified provider.
        Tenant information is automatically extracted from JWT token.
        
        **Statistics Include:**
        - Total request count
        - Success/error rates
        - Average processing time
        - Status code distribution
        - Error breakdown
      tags: [Logs]
      security:
        - BearerAuth: []
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [iyzico, ozanpay, stripe, paycell, papara, nkolay, paytr, payu]
          description: Payment provider name
          example: iyzico
        - name: hours
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 168
            default: 24
          description: Time range in hours (max 7 days)
          example: 24
      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          tenantId:
                            type: integer
                            example: 1
                          provider:
                            type: string
                            example: "iyzico"
                          hours:
                            type: integer
                            example: 24
                          stats:
                            $ref: '#/components/schemas/LoggingStats'
        '400':
          description: Invalid parameters or missing X-Tenant-ID header
        '401':
          description: Unauthorized - Invalid JWT token
        '500':
          description: Internal server error

  # Authentication Operations
  /v1/auth/register:
    post:
      summary: Register new user (Admin only)
      description: |
        Registers a new user account with special rules:
        
        **Registration Rules:**
        - ‚úÖ **First Registration**: If no users exist, registration creates the first admin user
        - ‚ùå **Subsequent Registrations**: Blocked - only admins can create new users via `/v1/auth/create-tenant`
        
        **First User Benefits:**
        - Automatically becomes admin
        - Gets full system access
        - Can create other users
        
        **Security:**
        - No authentication required for first user
        - Validates username uniqueness
        - Password must be at least 6 characters
        
        **Usage Scenarios:**
        1. **Fresh Installation**: First call creates admin user
        2. **Existing System**: Returns 403 Forbidden
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              first_admin:
                summary: First Admin Registration
                value:
                  username: "admin"
                  password: "securepassword123"
              blocked_registration:
                summary: Blocked Registration (after first user)
                value:
                  username: "user2"
                  password: "password123"
      responses:
        '201':
          description: Registration successful (first user only)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
              examples:
                success:
                  summary: Successful Registration
                  value:
                    success: true
                    message: "Registration successful"
                    data:
                      token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      expires_at: "2024-01-16T10:30:00Z"
                      username: "admin"
                      tenant_id: "1"
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                validation_error:
                  summary: Validation Error
                  value:
                    success: false
                    message: "Validation error"
                    error: "Username must be at least 3 characters"
        '403':
          description: Registration is closed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                registration_closed:
                  summary: Registration Closed
                  value:
                    success: false
                    message: "Registration is closed. Only administrators can create new accounts."
        '500':
          description: Internal server error

  /v1/auth/login:
    post:
      summary: User login
      description: |
        Authenticates a user and returns a JWT token for API access.
        
        **Authentication Flow:**
        1. Validate username and password
        2. Generate JWT token (24 hour expiry)
        3. Update last login timestamp
        4. Return token and user info
        
        **Token Usage:**
        - Include in Authorization header: `Bearer <token>`
        - Required for all protected endpoints
        - Auto-expires after 24 hours
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              admin_login:
                summary: Admin Login
                value:
                  username: "admin"
                  password: "securepassword123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid request format
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_credentials:
                  summary: Invalid Credentials
                  value:
                    success: false
                    message: "Invalid username or password"
        '500':
          description: Internal server error

  /v1/auth/logout:
    post:
      summary: User logout
      description: |
        Logs out the current user. Since JWT tokens are stateless, 
        this endpoint mainly provides a logout confirmation.
        
        **Note:** Clients should discard the JWT token after logout.
      tags: [Authentication]
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Logged out successfully"
        '401':
          description: Unauthorized - Invalid or missing token

  /v1/auth/change-password:
    post:
      summary: Change user password
      description: |
        Changes password for authenticated user or other users (admin only).
        
        **For Regular Users:**
        - Must provide current password for verification
        - Can only change their own password
        
        **For Admin Users (tenant_id=1):**
        - Can change any user's password by providing target_tenant_id
        - No current password required when changing other users' passwords
        - Current password required when changing own password
        
        **Security Requirements:**
        - New password must be at least 6 characters
        - User must be authenticated with valid JWT token
      tags: [Authentication]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
            examples:
              own_password_change:
                summary: Change Own Password
                value:
                  current_password: "oldpassword123"
                  new_password: "newpassword123"
              admin_change_other:
                summary: Admin Change Other User's Password
                value:
                  target_tenant_id: 3
                  new_password: "newpassword123"
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Password changed successfully"
                          target_tenant_id:
                            type: integer
                            example: 2
                            description: ID of the tenant whose password was changed
                          changed_by_admin:
                            type: boolean
                            example: false
                            description: Whether the password was changed by admin for another user
        '400':
          description: Invalid request data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missing_current_password:
                  summary: Missing Current Password
                  value:
                    success: false
                    message: "Current password is required when changing your own password"
        '401':
          description: Unauthorized or current password incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                wrong_password:
                  summary: Wrong Current Password
                  value:
                    success: false
                    message: "Current password is incorrect"
        '403':
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_admin:
                  summary: Non-admin Trying to Change Other's Password
                  value:
                    success: false
                    message: "Only administrators can change other users' passwords"
        '404':
          description: Target tenant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                tenant_not_found:
                  summary: Target Tenant Not Found
                  value:
                    success: false
                    message: "Target tenant not found"
        '500':
          description: Internal server error

  /v1/auth/create-tenant:
    post:
      summary: Create new tenant (Admin only)
      description: |
        Creates a new tenant account. Only available to authenticated admin users.
        
        **Admin Privileges:**
        - Only authenticated users can create new tenants
        - No limit on number of tenants
        - New tenant gets standard user privileges
        
        **Use Cases:**
        - Add new team members
        - Create service accounts
        - Manage multi-user access
      tags: [Authentication]
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTenantRequest'
            examples:
              new_tenant:
                summary: Create New Tenant
                value:
                  username: "newuser"
                  password: "password123"
      responses:
        '201':
          description: Tenant created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfile'
        '400':
          description: Invalid request data or validation error
        '401':
          description: Unauthorized - Admin access required
        '409':
          description: Username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                username_exists:
                  summary: Username Already Exists
                  value:
                    success: false
                    message: "Username already exists"
        '500':
          description: Internal server error

  /v1/auth/profile:
    get:
      summary: Get user profile
      description: |
        Retrieves the profile information for the authenticated user.
        
        **Returned Information:**
        - User ID and username
        - Account creation date
        - Last login timestamp
        - No sensitive data (passwords, tokens)
      tags: [Authentication]
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfile'
        '401':
          description: Unauthorized - Invalid or missing token
        '500':
          description: Internal server error

  /v1/auth/refresh:
    post:
      summary: Refresh JWT token
      description: |
        Refreshes an existing JWT token to extend its validity.
        
        **Token Refresh:**
        - Validates current token
        - Issues new token with extended expiry
        - Original token becomes invalid
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  description: Current JWT token to refresh
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Invalid token format
        '401':
          description: Token expired or invalid
        '500':
          description: Internal server error

  /v1/auth/validate:
    post:
      summary: Validate JWT token
      description: |
        Validates a JWT token and returns user information if valid.
        
        **Use Cases:**
        - Check token validity before API calls
        - Verify user identity
        - Get user info from token
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [token]
              properties:
                token:
                  type: string
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  description: JWT token to validate
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          valid:
                            type: boolean
                            example: true
                          user:
                            $ref: '#/components/schemas/UserProfile'
        '400':
          description: Invalid token format
        '401':
          description: Token expired or invalid
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ErrorResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          valid:
                            type: boolean
                            example: false
        '500':
          description: Internal server error
